<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-50">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HuDa Docs — Transformation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <link rel="stylesheet" href="./theme.css" />
  </head>
  <body class="min-h-screen jeton">
    <!-- Top Gradient Header -->
    <div class="w-full bg-gradient-to-r from-indigo-600 via-sky-600 to-emerald-600 text-white">
      <div class="max-w-7xl mx-auto px-4 md:px-6">
        <div class="flex items-center justify-between py-3">
          <div class="flex items-center gap-2">
            <i data-lucide="database" class="w-5 h-5"></i>
            <span class="font-semibold tracking-tight">HuDa — Humanitarian Data Library</span>
          </div>
          <div class="hidden md:flex items-center gap-4 text-sm opacity-90">
            <a href="./index.html#overview" class="inline-flex items-center gap-1 hover:opacity-100"><i data-lucide="home" class="w-4 h-4"></i>Overview</a>
            <a href="./index.html" class="inline-flex items-center gap-1 hover:opacity-100"><i data-lucide="book-open" class="w-4 h-4"></i>Docs</a>
            <a href="#about" class="inline-flex items-center gap-1 hover:opacity-100"><i data-lucide="info" class="w-4 h-4"></i>About Us</a>
            <a href="#contact" class="inline-flex items-center gap-1 hover:opacity-100"><i data-lucide="mail" class="w-4 h-4"></i>Contact Us</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Persistent Sidebar -->
    <aside class="hidden md:block fixed top-[48px] left-0 h-[calc(100vh-48px)] w-72 overflow-y-auto bg-white/80 backdrop-blur border-r border-white/60 shadow-sm p-4">
      <div class="flex items-center gap-2 mb-4">
        <i data-lucide="database" class="w-5 h-5 text-indigo-600"></i>
        <span class="text-sm font-semibold">HuDa Navigation</span>
      </div>
      <nav class="space-y-1 text-sm">
        <a href="./index.html#overview" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="home" class="w-4 h-4"></i>Overview</a>
        <div class="pt-2 pb-1 text-[10px] uppercase tracking-wider text-gray-500">Phases</div>
        <a href="./docs_opening.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="folder-open" class="w-4 h-4"></i>Opening</a>
        <a href="./docs_cleaning.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="brush" class="w-4 h-4"></i>Cleaning</a>
        <a href="./docs_transformation.html" class="flex items-center gap-2 px-3 py-2 rounded-md bg-indigo-50 text-indigo-700 hover:bg-indigo-100"><i data-lucide="workflow" class="w-4 h-4"></i>Transformation</a>
        <a href="./docs_validation_quality.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="shield-check" class="w-4 h-4"></i>Validation & Quality</a>
        <a href="./docs_geospatial.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="map" class="w-4 h-4"></i>Geospatial</a>
        <a href="./docs_analysis.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="line-chart" class="w-4 h-4"></i>Analysis</a>
        <a href="./docs_automation.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="workflow" class="w-4 h-4"></i>Automation</a>
        <a href="./docs_interoperability.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="share-2" class="w-4 h-4"></i>Interoperability</a>
        <a href="./docs_visualization.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="bar-chart-3" class="w-4 h-4"></i>Visualization</a>
        <a href="./docs_ml4humanitarian.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="bot" class="w-4 h-4"></i>ML for Humanitarian Data</a>
        <a href="./docs_document_processing.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="file-search" class="w-4 h-4"></i>Document Processing</a>
        <a href="./docs_humanitarian_metrics.html" class="flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-100 text-gray-700"><i data-lucide="activity" class="w-4 h-4"></i>Humanitarian Metrics</a>
      </nav>
    </aside>

    <!-- Content wrapper to offset sidebar -->
    <div class="md:pl-72">
    <div class="max-w-5xl mx-auto p-6 md:p-10">
      <header class="flex items-center justify-between mb-8">
        <div class="flex items-center gap-3">
          <i data-lucide="shuffle" class="w-6 h-6 text-indigo-600"></i>
          <h1 class="text-2xl font-bold tracking-tight">Phase: Transformation</h1>
        </div>
        <a href="./index.html" class="text-sm text-gray-600 hover:text-gray-900 inline-flex items-center gap-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> Back</a>
      </header>

      <p class="text-gray-700">We change/reshape the data. Very simple English. Afghan examples. Colorful and copyable.</p>

      <!-- pivot_unpivot -->
      <section class="mt-8 rounded-lg border border-gray-200 bg-white p-5" id="pivot-unpivot">
        <div class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-2">
          <i data-lucide="table-2" class="w-4 h-4"></i>
          pivot_unpivot(data, index, columns, values, operation="pivot|unpivot")
        </div>
        <p class="text-gray-700 text-sm"><strong>What:</strong> Change table shape: wide ↔ long.</p>
        <p class="text-gray-700 text-sm"><strong>When:</strong> You have columns like <em>beneficiaries_jan, beneficiaries_feb</em> and want one "month" column, or the opposite.</p>
        <p class="text-gray-700 text-sm"><strong>Why:</strong> Easier charts and analysis. Many tools prefer long format.</p>
        <div class="grid md:grid-cols-2 gap-6 mt-4">
          <div>
            <h3 class="text-sm font-semibold">Parameters</h3>
            <ul class="text-sm text-gray-700 list-disc pl-6">
              <li><code>data</code>: CSV path, Pandas or Polars table.</li>
              <li><code>index</code>: id columns to keep (example: <code>["province"]</code>).</li>
              <li><code>columns</code>: only for pivot (example: <code>"month"</code>).</li>
              <li><code>values</code>: columns to pivot/unpivot (example: <code>["beneficiaries_jan","beneficiaries_feb"]</code>).</li>
              <li><code>operation</code>: <code>"pivot"</code> or <code>"unpivot"</code>.</li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold">Example</h3>
            <div class="relative">
              <button class="copy-btn absolute top-2 right-2 text-xs px-2 py-1 rounded bg-gray-700 text-white">Copy</button>
              <pre class="rounded-md bg-gray-900 text-gray-100 p-3 overflow-auto"><code class="language-python">from huda.transformation.pivot_unpivot import pivot_unpivot
import polars as pl

df = pl.DataFrame({
  "province": ["Kabul","Herat","Kandahar"],
  "beneficiaries_jan": [120,200,250],
  "beneficiaries_feb": [150,180,300],
})

long_df = pivot_unpivot(df, index=["province"], values=["beneficiaries_jan","beneficiaries_feb"], operation="unpivot")
print(long_df)
</code></pre>
            </div>
          </div>
        </div>
        <p class="text-gray-700 text-sm mt-2"><strong>Output:</strong> A Polars table in the new shape. For unpivot, you get columns like <code>variable</code> and <code>value</code>.</p>
      </section>

      <!-- percentage_calculation -->
      <section class="mt-8 rounded-lg border border-gray-200 bg-white p-5" id="percentage">
        <div class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-2">
          <i data-lucide="percent" class="w-4 h-4"></i>
          percentage_calculation(data, numerator_columns, denominator_column, suffix="_pct")
        </div>
        <p class="text-gray-700 text-sm"><strong>What:</strong> Create percentage columns like <em>in_need_pct</em>.</p>
        <p class="text-gray-700 text-sm"><strong>When:</strong> You have totals (population) and parts (people_in_need).</p>
        <p class="text-gray-700 text-sm"><strong>Why:</strong> Percent is easier to compare than raw counts across provinces.</p>
        <div class="grid md:grid-cols-2 gap-6 mt-4">
          <div>
            <h3 class="text-sm font-semibold">Parameters</h3>
            <ul class="text-sm text-gray-700 list-disc pl-6">
              <li><code>data</code>: CSV or Polars table.</li>
              <li><code>numerator_columns</code>: list of columns (example: <code>["people_in_need"]</code>).</li>
              <li><code>denominator_column</code>: total column (example: <code>"population"</code>).</li>
              <li><code>suffix</code>: default <code>_pct</code>.</li>
            </ul>
          </div>
          <div>
            <h3 class="text-sm font-semibold">Example</h3>
            <div class="relative">
              <button class="copy-btn absolute top-2 right-2 text-xs px-2 py-1 rounded bg-gray-700 text-white">Copy</button>
              <pre class="rounded-md bg-gray-900 text-gray-100 p-3 overflow-auto"><code class="language-python">from huda.transformation.percentage_calculation import percentage_calculation
import pl as polars

import polars as pl
df = pl.DataFrame({
  "province": ["Kabul","Herat","Kandahar"],
  "population": [4500000,1000000,1200000],
  "people_in_need": [900000,150000,200000],
})
print(percentage_calculation(df, ["people_in_need"], "population"))
</code></pre>
            </div>
          </div>
        </div>
        <p class="text-gray-700 text-sm mt-2"><strong>Output:</strong> Same table plus new columns like <code>people_in_need_pct</code> with percentages.</p>
      </section>

      <!-- population_based_normalization -->
      <section class="mt-8 rounded-lg border border-gray-200 bg-white p-5" id="per-pop">
        <div class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-2">
          <i data-lucide="ratio" class="w-4 h-4"></i>
          population_based_normalization(data, value_columns, population_column, per=1000)
        </div>
        <p class="text-gray-700 text-sm"><strong>What:</strong> Convert counts to per-<code>per</code> people (per 1,000 by default).</p>
        <p class="text-gray-700 text-sm"><strong>When:</strong> Comparing provinces with different population sizes.</p>
        <p class="text-gray-700 text-sm"><strong>Why:</strong> Fair comparisons (rates).</p>
        <div class="relative mt-2">
          <button class="copy-btn absolute top-2 right-2 text-xs px-2 py-1 rounded bg-gray-700 text-white">Copy</button>
          <pre class="rounded-md bg-gray-900 text-gray-100 p-3 overflow-auto"><code class="language-python">from huda.transformation.population_based_normalization import population_based_normalization
import polars as pl

df = pl.DataFrame({
  "province": ["Kabul","Herat","Kandahar"],
  "population": [4500000,1000000,1200000],
  "patients": [23000,5000,8000],
})
print(population_based_normalization(df, ["patients"], "population", per=1000))
</code></pre>
        </div>
      </section>

      <!-- average_rolling & monthly_yearly_growth -->
      <section class="mt-8 rounded-lg border border-gray-200 bg-white p-5" id="time-series">
        <div class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-2">
          <i data-lucide="trending-up" class="w-4 h-4"></i>
          average_rolling(...) & monthly_yearly_growth(...)
        </div>
        <p class="text-gray-700 text-sm"><strong>What:</strong> Smooth with moving average; compute month-over-month or year-over-year growth.</p>
        <p class="text-gray-700 text-sm"><strong>When:</strong> Time series of beneficiaries or cases.</p>
        <p class="text-gray-700 text-sm"><strong>Why:</strong> See trends clearly.</p>
        <div class="relative mt-2">
          <button class="copy-btn absolute top-2 right-2 text-xs px-2 py-1 rounded bg-gray-700 text-white">Copy</button>
          <pre class="rounded-md bg-gray-900 text-gray-100 p-3 overflow-auto"><code class="language-python">from huda.transformation.average_rolling import average_rolling
from huda.transformation.monthly_yearly_growth import monthly_yearly_growth
import polars as pl

df = pl.DataFrame({"date":["2024-01-01","2024-02-01","2024-03-01"], "beneficiaries":[100,150,200]})
print(average_rolling(df, value_columns=["beneficiaries"], window=2))
print(monthly_yearly_growth(df, value_column="beneficiaries", date_column="date", period="monthly"))
</code></pre>
        </div>
      </section>

      <!-- age/gender standardization, categorical mapping -->
      <section class="mt-8 rounded-lg border border-gray-200 bg-white p-5" id="standardization">
        <div class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-2">
          <i data-lucide="users" class="w-4 h-4"></i>
          age_group_standardization(...) • gender_group_standardization(...) • categorical_code_to_label(...)
        </div>
        <p class="text-gray-700 text-sm"><strong>What:</strong> Make consistent age bins, gender labels, and code-to-label mapping.</p>
        <p class="text-gray-700 text-sm"><strong>When:</strong> Datasets have different age/gender/codes styles.</p>
        <p class="text-gray-700 text-sm"><strong>Why:</strong> Clean categories for grouping and charts.</p>
        <div class="relative mt-2">
          <button class="copy-btn absolute top-2 right-2 text-xs px-2 py-1 rounded bg-gray-700 text-white">Copy</button>
          <pre class="rounded-md bg-gray-900 text-gray-100 p-3 overflow-auto"><code class="language-python">from huda.transformation.age_group_standardization import age_group_standardization
from huda.transformation.gender_group_standardization import gender_group_standardization
from huda.transformation.categorical_code_to_label import categorical_code_to_label
import polars as pl

df = pl.DataFrame({"age":[2,17,35,70], "gender":["M","F","Male","female"], "sector":[1,2,1,3]})
print(age_group_standardization(df, age_column="age"))
print(gender_group_standardization(df, gender_column="gender"))
print(categorical_code_to_label(df, code_column="sector", mapping={1:"Food",2:"Shelter",3:"Education"}))
</code></pre>
        </div>
      </section>

      <!-- coverage & severity & zscore -->
      <section class="mt-8 rounded-lg border border-gray-200 bg-white p-5" id="indices">
        <div class="flex items-center gap-2 text-base font-semibold text-gray-900 mb-2">
          <i data-lucide="gauge" class="w-4 h-4"></i>
          needs_coverage_calculation(...) • averages_weighted_population(...) • severity_index_calculation(...) • z_score_calculation(...)
        </div>
        <p class="text-gray-700 text-sm"><strong>What:</strong> Build coverage %, indices, and z-scores for anomalies.</p>
        <p class="text-gray-700 text-sm"><strong>When:</strong> You need summarized indicators for reporting.</p>
        <p class="text-gray-700 text-sm"><strong>Why:</strong> Clear decision-making and quality checks.</p>
        <div class="relative mt-2">
          <button class="copy-btn absolute top-2 right-2 text-xs px-2 py-1 rounded bg-gray-700 text-white">Copy</button>
          <pre class="rounded-md bg-gray-900 text-gray-100 p-3 overflow-auto"><code class="language-python">from huda.transformation.needs_coverage_calculation import needs_coverage_calculation
from huda.transformation.averages_weighted_population import averages_weighted_population
from huda.transformation.severity_index_calculation import severity_index_calculation
from huda.transformation.z_score_calculation import z_score_calculation
import polars as pl

df = pl.DataFrame({
  "population":[5_000_000,2_000_000],
  "food_needs":[1000,800], "food_provided":[800,500],
  "water_needs":[5000,4000], "water_provided":[4000,2500],
})
print(needs_coverage_calculation(df, ["food_needs","water_needs"], ["food_provided","water_provided"]))
print(z_score_calculation(df.with_columns(pl.col("food_needs").alias("amount")), column="amount"))
</code></pre>
        </div>
      </section>

      <footer class="text-xs text-gray-500 mt-10">© <span id="year"></span> HuDa</footer>
    </div>

    <script>
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();
      lucide.createIcons();
      if (window.hljs) { hljs.highlightAll(); }
      document.querySelectorAll('.copy-btn').forEach((btn) => {
        btn.addEventListener('click', () => {
          const pre = btn.nextElementSibling;
          const code = pre && pre.querySelector('code');
          if (!code) return;
          const text = code.innerText;
          navigator.clipboard.writeText(text).then(() => {
            const old = btn.textContent;
            btn.textContent = 'Copied!';
            setTimeout(() => (btn.textContent = old), 1200);
          });
        });
      });
    </script>
    </div>

    <!-- Footer -->
    <footer class="border-t border-white/60 bg-white/70 backdrop-blur supports-[backdrop-filter]:bg-white/60">
      <div class="max-w-7xl mx-auto px-4 md:px-6 py-6 flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="text-sm text-gray-600">© <span id="year"></span> HuDa. Built for humanitarian analysts.</div>
        <div class="flex items-center gap-4 text-gray-600">
          <a href="#about" class="inline-flex items-center gap-1 hover:text-gray-900"><i data-lucide="info" class="w-4 h-4"></i>About</a>
          <a href="#contact" class="inline-flex items-center gap-1 hover:text-gray-900"><i data-lucide="mail" class="w-4 h-4"></i>Contact</a>
        </div>
      </div>
    </footer>
  </body>
</html>
